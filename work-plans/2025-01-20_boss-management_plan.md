# 보스 관리 시스템 작업 계획서

**작성일:** 2025-01-20  
**작성자:** Claude  
**기능명:** 보스 관리 시스템  
**예상 작업 시간:** 3-4시간  

---

## 📋 기능 개요

### 목표
- 길드 내 보스 정보를 체계적으로 관리할 수 있는 시스템 구축
- 보스 추가, 조회, 수정, 삭제 기능 제공
- Google Sheets 연동을 통한 데이터 영속성 확보

### 주요 기능
- 보스 추가 (모달 인터페이스 활용)
- 보스 목록 조회 (페이지네이션 지원)
- 개별 보스 상세 정보 조회
- 보스 정보 수정 (운영진 이상)
- 보스 삭제 (관리자 전용)

### 사용자 스토리
- **운영진으로서** 게임 내 존재하는 보스 정보를 **나는** 체계적으로 관리하고 싶다 **왜냐하면** 길드원들에게 정확한 보스 스케줄과 리젠 정보를 제공하기 위해
- **운영진으로서** 보스별 참여 점수와 리젠 타입을 **나는** 설정하고 싶다 **왜냐하면** 길드원들의 참여도를 공정하게 관리하기 위해
- **운영진으로서** 보스 스케줄 관리 노출 여부를 **나는** 제어하고 싶다 **왜냐하면** 상황에 따라 특정 보스는 비공개로 관리해야 하기 때문에

---

## 🛠 상세 구현 계획

### 1. 명령어 설계

#### 보스 추가 명령어
- **명령어명:** `!보스추가`
- **별칭:** `!보스등록`, `!addboss`
- **사용법:** `!보스추가` (모달 인터페이스로 정보 입력)
- **권한:** 운영진 이상
- **쿨다운:** 10초

#### 보스 목록 명령어  
- **명령어명:** `!보스목록`
- **별칭:** `!보스`, `!bosslist`
- **사용법:** `!보스목록`
- **권한:** 일반길드원 이상
- **쿨다운:** 5초

#### 보스 정보 명령어
- **명령어명:** `!보스정보`
- **별칭:** `!bossinfo`
- **사용법:** `!보스정보 <보스명>`
- **권한:** 일반길드원 이상
- **쿨다운:** 3초

#### 보스 삭제 명령어
- **명령어명:** `!보스삭제`
- **별칭:** `!deleteboss`
- **사용법:** `!보스삭제 <보스명>`
- **권한:** 관리자 전용
- **쿨다운:** 15초

### 2. 데이터베이스 (Google Sheets) 변경
- **시트명:** `보탐봇-보스정보` (기존 시트 활용)
- **기존 컬럼 구조:**
  ```
  보스명 | 점수 | 스케줄타입 | 스케줄정보 | 생성일시
  ```
- **새로운 컬럼 구조:**
  ```
  보스명 | 점수 | 리젠타입 | 리젠설정 | 스케줄노출여부 | 등록자 | 생성일시 | 수정일시
  ```

#### 리젠 타입 상세
- **"시간마다"**: N시간마다 리젠 (예: "3시간마다")
  - 리젠설정: `{"hours": 3}`
- **"특정요일"**: 특정 요일의 특정 시간에 리젠 (예: "화, 목, 토 21:00")
  - 리젠설정: `{"days": ["화", "목", "토"], "time": "21:00"}`

#### 스케줄 노출 여부
- **"노출"**: 길드원들에게 스케줄 관리 시 표시
- **"비노출"**: 운영진만 관리, 길드원에게는 숨김

### 3. UI/UX 설계

#### 보스 추가 모달
```
📋 보스 정보 등록
┌─────────────────────────────┐
│ 보스명: [텍스트 입력]        │
│ 참여점수: [숫자 입력]        │
│ 리젠타입: [시간마다/특정요일] │
│ 리젠설정: [상세설정]         │
│ 스케줄노출: [노출/비노출]     │
│ ┌─────────┐ ┌─────────┐     │
│ │  등록   │ │  취소   │     │
│ └─────────┘ └─────────┘     │
└─────────────────────────────┘
```

#### 보스 목록 응답
```
🐉 등록된 보스 목록

🔥 **데스나이트**
   └ 💰 15점 | ⏰ 3시간마다 | 👁️ 노출

⚡ **드래곤 로드** 
   └ 💰 25점 | 📅 화,목,토 21:00 | 👁️ 노출

🌙 **리치킹**
   └ 💰 20점 | ⏰ 6시간마다 | 🔒 비노출

💡 상세 정보는 '!보스정보 <보스명>' 명령어를 사용하세요.
```

### 4. 비즈니스 로직
- **중복 보스명 검증:** 동일한 보스명 등록 방지
- **점수 범위 검증:** 1-100점 사이의 값만 허용
- **권한별 기능 제한:** 일반길드원은 조회만, 운영진은 추가/수정, 관리자는 모든 권한
- **리젠타입 검증:** "시간마다" 또는 "특정요일"만 허용
- **리젠설정 검증:** 
  - 시간마다: 1-168시간 사이 (1주일 이내)
  - 특정요일: 유효한 요일과 24시간 형식 시간
- **스케줄노출여부:** "노출" 또는 "비노출"만 허용
- **검색 기능:** 보스명으로 부분 검색 가능

---

## 📂 파일 변경 사항

### 신규 생성 파일
- `src/commands/text/user/bossInfo.js` - 보스 정보 조회 명령어
- `src/commands/text/user/bossList.js` - 보스 목록 조회 명령어  
- `src/commands/text/admin/bossAdd.js` - 보스 추가 명령어 (운영진 이상)
- `src/commands/text/admin/bossDelete.js` - 보스 삭제 명령어 (관리자 전용)
- `src/commands/interactions/bossModal.js` - 보스 추가 모달 처리
- `src/services/bossService.js` - 보스 관련 비즈니스 로직

### 수정할 기존 파일
- `src/services/googleSheetsService.js`
  - `getBossList()`: 보스 목록 조회 메서드 추가
  - `getBossByName()`: 보스명으로 개별 조회 메서드 추가
  - `addBoss()`: 보스 추가 메서드 추가
  - `updateBoss()`: 보스 정보 수정 메서드 추가
  - `deleteBoss()`: 보스 삭제 메서드 추가
  - `getSheetHeaders()`: 보스정보 시트 헤더 확장
- `src/commands/text/user/help.js`
  - 새 명령어들 추가
- `src/config/constants.js`
  - 보스 관련 상수 추가 (최대 점수, 페이지 사이즈 등)

### 문서 업데이트
- `USER_GUIDE.md` - 보스 관리 명령어 사용법 추가
- `CLAUDE.md` - 보스 관리 시스템 아키텍처 문서화

---

## 🧪 테스트 계획

### 단위 테스트
- `bossService.validateBossData()` - 보스 데이터 유효성 검증
- `googleSheetsService.addBoss()` - 보스 추가 기능
- 중복 보스명 검증 로직

### 통합 테스트
- Google Sheets 연동 (CRUD 작업)
- Discord 모달 인터랙션
- 권한별 명령어 접근 제어

### 수동 테스트 시나리오
1. **보스 추가 시나리오:**
   - `!보스추가` → 모달 열기 → 정보 입력 → 등록 확인
2. **보스 목록 조회:**
   - `!보스목록` → 목록 표시 → 페이지네이션 테스트
3. **권한 테스트:**
   - 일반길드원으로 보스 추가 시도 → 권한 부족 메시지
4. **에러 시나리오:**
   - 중복 보스명 등록 시도
   - 존재하지 않는 보스 정보 조회

---

## ⚠️ 주의사항 및 리스크

### 기술적 리스크
- **Google Sheets API 제한:** 대량의 보스 데이터 처리 시 성능 이슈 가능
  - **해결방안:** 페이지네이션과 캐싱 활용
- **모달 상호작용 복잡성:** Discord.js 모달 처리의 에러 핸들링
  - **해결방안:** 상세한 에러 처리 및 사용자 피드백

### 사용자 경험 고려사항
- **모달 입력의 복잡성:** 사용자가 많은 정보를 한 번에 입력해야 함
  - **해결방안:** 필수/선택 필드 구분, 도움말 제공
- **검색 성능:** 보스 수가 많아질 경우 검색 속도 저하
  - **해결방안:** 인덱싱 및 부분 검색 최적화

### 호환성 이슈
- **기존 보스정보 시트:** 컬럼 구조 변경으로 인한 기존 데이터 마이그레이션
  - **해결방안:** `!시트동기화` 명령어 활용

---

## 📈 성공 기준

### 기능적 요구사항
- [ ] 운영진이 보스를 추가할 수 있다
- [ ] 일반길드원이 보스 목록을 조회할 수 있다
- [ ] 보스 상세 정보를 조회할 수 있다
- [ ] 관리자가 보스를 삭제할 수 있다
- [ ] 중복 보스명 등록이 차단된다
- [ ] 권한별 접근 제어가 정상 작동한다

### 비기능적 요구사항
- [ ] 모달 응답 시간 3초 이내
- [ ] 보스 목록 조회 5초 이내
- [ ] 사용자 친화적 에러 메시지
- [ ] 페이지네이션 정상 작동

---

## 🚀 배포 계획

### 배포 전 체크리스트
- [ ] 모든 명령어 테스트 완료
- [ ] 권한 시스템 테스트 완료
- [ ] Google Sheets 연동 테스트 완료
- [ ] 사용자 가이드 업데이트
- [ ] `!시트동기화`로 기존 시트 구조 업데이트

### 배포 후 모니터링
- 보스 등록 성공률
- 명령어 사용 빈도
- 에러 발생률 및 유형
- 사용자 피드백 (모달 사용성, 검색 편의성)

---

## 📝 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2025-01-20 | v1.0 | 보스 관리 시스템 초기 계획서 작성 | Claude |

---

**승인 상태:** ⏳ 검토 중  
**승인자:** [사용자명]  
**승인일:** [승인 후 기입]