# !점검 명령어 가이드

## 개요
`!점검` 명령어는 게임 점검 완료 시간을 입력받아 시간마다 리젠되는 모든 보스들의 컷타임을 점검완료시간으로 일괄 설정하는 기능입니다. 점검 후 첫 리젠까지는 개별 보스명 대신 "보스런" 통합 알림을 제공합니다.

## 기본 사용법

### 지원 형식
- `!점검 MMDDHHMM`: 해당 월일시간에 점검 완료

### 사용 예시
```
!점검 09211400
→ 9월 21일 14:00에 점검 완료, 모든 시간마다 리젠 보스들을 해당 시간으로 설정
```

## 핵심 기능

### 1. 일괄 컷타임 설정
- **대상**: 시간마다 리젠되는 모든 보스
- **제외**: 특정요일 리젠 보스
- **설정값**: 점검완료시간 = 첫 젠타임 = 컷타임

### 2. 점검 모드 알림 시스템
점검 후 첫 리젠까지는 개별 텍스트 + 통합 음성 알림으로 변경:

**일반 모드 (평상시):**
```
텍스트: 베나투스 5분전
음성: "베나투스 리젠 5분전입니다"

텍스트: 데스나이트 1분전 [컷 버튼]
음성: "데스나이트 리젠 1분전입니다"
```

**점검 모드 (점검 후 첫 리젠까지):**
```
음성: "보스런 5분전입니다" (1회, 먼저 재생)
텍스트: 베나투스 5분전
텍스트: 데스나이트 5분전
...

음성: "보스런 1분전입니다" (1회, 먼저 재생)
텍스트: 베나투스 1분전 [컷 버튼]
텍스트: 데스나이트 1분전 [컷 버튼]
...
```

### 3. 자동 모드 전환
- **자동 해제**: 첫 번째 보스 컷타임 등록 시 점검 모드 자동 해제
- **해제 방법**: `!컷` 명령어 또는 컷 버튼 클릭
- **피드백**: "보스명 컷타임 설정 완료. 시간\n점검 모드가 해제되었습니다."

## 시스템 로직

### 점검 완료 시간 처리
```
점검완료시간 = 새로운 컷타임
```

**예시:**
- 점검완료: 2025-09-21 14:00
- 베나투스 (3시간마다): 컷타임 = 2025-09-21 14:00 → 다음 젠 = 17:00
- 데스나이트 (4시간마다): 컷타임 = 2025-09-21 14:00 → 다음 젠 = 18:00

### 점검 모드 플래그 관리
```javascript
// 점검 모드 활성화 조건
- !점검 명령어 실행 시 자동 활성화
isMaintenanceMode = true

// 점검 모드 해제 조건
- 첫 번째 보스 컷타임 등록 시 자동 해제
- !컷 명령어 또는 컷 버튼 클릭
isMaintenanceMode = false
```

## 권한 및 제한사항

### 권한 요구사항
- **운영진 이상** 명령어
- Google Sheets 기반 권한 체크

### 제한사항
- MMDDHHMM 형식만 지원 (HHMM 형식 미지원)
- 시간마다 리젠 보스만 대상
- 특정요일 리젠 보스는 영향받지 않음

## 성공 응답 예시
```
점검 업데이트 완료. 09월 21일 14:00
시간마다 리젠 보스 12개 일괄 설정됨.
```

## 오류 메시지

### 일반적인 오류
- `점검완료시간을 입력해주세요.`
- `운영진 이상만 사용 가능한 명령어입니다.`
- `시트에 등록되지 않은 사용자입니다.`

### 시간 형식 오류
- `점검완료시간은 숫자만 입력해주세요. (MMDDHHMM)`
- `월은 01-12 사이로 입력해주세요.`
- `일은 01-31 사이로 입력해주세요.`
- `시간은 00-23 사이로 입력해주세요.`
- `분은 00-59 사이로 입력해주세요.`
- `점검완료시간 형식이 올바르지 않습니다. (MMDDHHMM)`
- `올바르지 않은 날짜입니다.`

### 시스템 오류
- `시간마다 리젠되는 보스가 없습니다.`
- `점검 모드 활성화 실패`

## 기술적 구현

### 핵심 파일
- `/src/commands/text/admin/maintenance.js` - 메인 명령어 파일
- `/src/utils/timeCalculator.js` - 시간 계산 (기존 재사용)
- `/src/services/schedulerService.js` - 점검 모드 알림 로직
- `/src/services/maintenanceService.js` - 점검 모드 상태 관리

### 데이터 저장
점검 모드 상태는 다음 중 하나로 관리:
1. **메모리 방식**: 봇 재시작 시 초기화 (간단함)
2. **파일 방식**: 로컬 파일에 저장 (지속성)
3. **시트 방식**: Google Sheets 설정 시트 활용 (동기화)

### 스케줄러 통합
```javascript
// 점검 모드 처리 로직
if (isMaintenanceMode()) {
  // 1. 통합 음성 알림 먼저 재생
  await sendMaintenanceTTS("보스런 5분전입니다");

  // 2. 개별 텍스트 메시지 발송 (컷 버튼 포함)
  for (const boss of bosses) {
    await sendBossMessage(`${boss.name} 5분전`, skipTTS: true);
  }
} else {
  // 일반 모드: 개별 알림
  await sendBossNotification(`${boss.name} 5분전`);
}
```

## 사용 시나리오

### 정기점검 시나리오
1. **점검 시작**: 게임 서버 점검 시작
2. **점검 완료**: 오후 2시에 점검 완료
3. **명령어 실행**: `!점검 09211400`
4. **시스템 처리**:
   - 모든 시간마다 리젠 보스의 컷타임을 14:00으로 설정
   - 점검 모드 활성화
5. **알림 변경**:
   - 음성: "보스런 5분전입니다" (통합, 먼저 재생)
   - 텍스트: 개별 보스별 메시지 + 컷 버튼
6. **자동 해제**: 첫 번째 보스 컷 등록 시 점검 모드 해제

### 긴급점검 시나리오
1. **긴급점검**: 예상치 못한 긴급점검 발생
2. **점검 완료**: 밤 11시 30분에 긴급점검 완료
3. **명령어 실행**: `!점검 09212330`
4. **즉시 적용**: 모든 보스 젠타임이 23:30 기준으로 재설정

## 확장 가능성

### 향후 개선 사항
1. **점검 모드 수동 해제**: `!점검해제` 명령어
2. **점검 예약 기능**: 미리 점검 시간 예약
3. **점검 알림**: 점검 시작 전 사전 알림
4. **점검 이력**: 점검 기록 관리

### 현재 구현 상태 (2025-09-21)
✅ **완료된 기능**:
- !점검 명령어 기본 기능
- 점검 모드 자동 활성화/해제
- 개별 텍스트 + 통합 음성 알림 시스템
- 컷 버튼 유지로 사용자 편의성 확보
- 음성 알림 우선 재생으로 자연스러운 UX

✅ **핵심 특징**:
- 음성: "보스런 X분전입니다" (1회만, 먼저 재생)
- 텍스트: 개별 보스별 메시지 + 컷 버튼
- 첫 컷 등록 시 자동 점검 모드 해제

### 다른 명령어와의 연계
- `!젠` 명령어: 개별 보스 젠타임 조정
- `!컷` 명령어: 개별 보스 컷타임 등록
- `!보스일정` 명령어: 점검 모드 상태 표시

---
*업데이트: 2025-09-21 !점검 명령어 구현 및 테스트 완료*
*최종 구현: 개별 텍스트 + 통합 음성 알림 시스템으로 최적화*